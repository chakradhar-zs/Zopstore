name: Workflow-Pipeline
"on": push

jobs:
  setup:
    name: Setup
    runs-on: ubuntu-latest
    steps:
      - name: Get branch prefix
        id: get_branch_prefix
        run: echo "::set-output name=prefix::$(echo $GITHUB_REF | sed 's/refs\/heads\///' | cut -d/ -f1)"

      - name: Set environment variable
        run: echo "BRANCH_PREFIX=${{ steps.get_branch_prefix.outputs.prefix }}" >> $GITHUB_ENV
      
      - name: Checks the branch prefix
        if: "!contains(env.BRANCH_PREFIX,'Day')"
        run: echo "Branch name does not contain 'Day' in its prefix"
        
      - name: Set up  Go 1.19
        uses: actions/setup-go@v2
        with:
          go-version: 1.19
        id: Go

      - name: Checkout code into go module directory
        uses: actions/checkout@v2

      - name: Get dependencies
        run: |
          go get -v -t -d ./...

      - name: Test
        run: |
          cd $BRANCH_PREFIX
          go test ./...